import{r as l,c as v,A as k,S as F,j as e,h as C,i as S,b as D,e as A,M as E}from"./index-OnCL7RT-.js";import{a as K}from"./geminiServiceOptimized-CluguWVt.js";import{u as R}from"./useSpeechRecognition-DBn9tqYM.js";import"./vendor-CMJYdXG8.js";const B=({onDataExtracted:m})=>{const{isListening:i,transcript:d,startListening:g,stopListening:s,error:b}=R(),[t,c]=l.useState(!1),[x,o]=l.useState(""),u=l.useRef("");l.useEffect(()=>{!i&&d&&d!==u.current&&(u.current=d,N(d))},[i,d]);const N=async n=>{c(!0),o("");try{const r=await K(n);m(r)}catch{o("Falha ao processar o áudio com a IA. Tente novamente.")}finally{c(!1)}},j=()=>{i?s():(u.current="",g())},a=x||b;return e.jsxs("div",{className:"p-4 bg-base-800 rounded-lg mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Cadastro Rápido por Voz"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:j,disabled:t,className:`flex items-center justify-center w-16 h-16 rounded-full transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-base-900 ${i?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-brand-primary hover:bg-brand-primary-light focus:ring-brand-primary"} ${t?"bg-base-700 cursor-not-allowed":""}`,"aria-label":i?"Parar gravação":"Iniciar gravação",children:t?e.jsx(D,{}):i?e.jsx(A,{className:"w-8 h-8 text-white"}):e.jsx(E,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-300",children:t?"Processando com Gemini...":i?"Gravando... Fale os dados do animal.":"Pressione para iniciar a gravação dos dados."}),d&&e.jsxs("p",{className:"text-sm text-brand-primary-light mt-1 italic",children:['"',d,'"']}),a&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:a})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:'Ex: "Cadastrar brinco 2030, nome Fagulha, raça Braford, macho..." Os campos serão preenchidos automaticamente.'})]})},w={brinco:"",nome:"",raca:v.Braford,sexo:F.Femea,pesoKg:"",dataNascimento:"",status:k.Ativo,paiNome:"",maeNome:"",maeRaca:v.Braford},M=({isOpen:m,onClose:i,onAddAnimal:d,animals:g})=>{const[s,b]=l.useState(w),[t,c]=l.useState({});l.useEffect(()=>{m||(b(w),c({}))},[m]);const x=a=>{const n=a.trim();return n?g.some(r=>r.brinco.toLowerCase()===n.toLowerCase())?(c(r=>({...r,brinco:"Este brinco já está cadastrado."})),!1):(c(r=>({...r,brinco:void 0})),!0):(c(r=>({...r,brinco:"O brinco é obrigatório."})),!1)},o=a=>{const{name:n,value:r}=a.target;n==="brinco"&&x(r),b(y=>{const p={...y,[n]:r};if(n==="maeNome"){const h=g.find(f=>f.brinco.toLowerCase()===r.trim().toLowerCase());h&&(p.maeRaca=h.raca)}return p})},u=a=>{b(n=>({...n,...a,pesoKg:a.pesoKg?String(a.pesoKg):"",dataNascimento:a.dataNascimento?new Date(a.dataNascimento).toISOString().split("T")[0]:n.dataNascimento})),a.brinco&&x(a.brinco)},N=a=>{if(a.preventDefault(),!x(s.brinco))return;const r=parseFloat(s.pesoKg),y=!isNaN(r)&&r>0?r:0;let p;if(s.dataNascimento){const f=new Date(s.dataNascimento+"T00:00:00");isNaN(f.getTime())||(p=f)}c({});const h={brinco:s.brinco,nome:s.nome,raca:s.raca,sexo:s.sexo,status:s.status,paiNome:s.paiNome,maeNome:s.maeNome,maeRaca:s.maeRaca,pesoKg:y,dataNascimento:p};d(h)},j=!s.brinco||!!t.brinco;return e.jsxs(C,{isOpen:m,onClose:i,title:"Cadastrar Novo Animal",children:[e.jsx(B,{onDataExtracted:u}),e.jsxs("form",{onSubmit:N,className:"space-y-6 pb-48 md:pb-4",children:[e.jsxs("div",{className:"relative border border-base-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"absolute -top-3 left-4 bg-base-800 px-2 text-md font-semibold text-brand-primary-light",children:"Identificação do Animal"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"brinco",className:"block text-sm font-medium text-gray-300",children:"Brinco"}),e.jsx("input",{type:"text",name:"brinco",id:"brinco",value:s.brinco,onChange:o,className:`mt-1 block w-full bg-base-700 border rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary sm:text-sm p-2 ${t.brinco?"border-red-500":"border-base-600"}`,required:!0}),t.brinco&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:t.brinco})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nome",className:"block text-sm font-medium text-gray-300",children:"Nome"}),e.jsx("input",{type:"text",name:"nome",id:"nome",value:s.nome,onChange:o,className:"mt-1 block w-full bg-base-700 border-base-600 rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary sm:text-sm p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"raca",className:"block text-sm font-medium text-gray-300",children:"Raça"}),e.jsx("select",{name:"raca",id:"raca",value:s.raca,onChange:o,className:"mt-1 block w-full bg-base-700 border-base-600 rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary sm:text-sm p-2",children:Object.values(v).map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sexo",className:"block text-sm font-medium text-gray-300",children:"Sexo"}),e.jsx("select",{name:"sexo",id:"sexo",value:s.sexo,onChange:o,className:"mt-1 block w-full bg-base-700 border-base-600 rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary sm:text-sm p-2",children:Object.values(F).map(a=>e.jsx("option",{value:a,children:a},a))})]})]})]}),e.jsxs("div",{className:"relative border border-base-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"absolute -top-3 left-4 bg-base-800 px-2 text-md font-semibold text-brand-primary-light",children:"Dados de Nascimento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"dataNascimento",className:"block text-sm font-medium text-gray-300",children:["Data de Nascimento ",e.jsx("span",{className:"text-gray-500 text-xs",children:"(opcional)"})]}),e.jsx("input",{type:"date",name:"dataNascimento",id:"dataNascimento",value:s.dataNascimento,onChange:o,className:"mt-1 block w-full bg-base-700 border border-base-600 rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary sm:text-sm p-2"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"pesoKg",className:"block text-sm font-medium text-gray-300",children:["Peso ao Nascer (kg) ",e.jsx("span",{className:"text-gray-500 text-xs",children:"(opcional)"})]}),e.jsx("input",{type:"number",step:"0.1",name:"pesoKg",id:"pesoKg",value:s.pesoKg,onChange:o,className:`mt-1 block w-full bg-base-700 border rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary sm:text-sm p-2 ${t.pesoKg?"border-red-500":"border-base-600"}`}),t.pesoKg&&e.jsx("p",{className:"text-red-400 text-xs mt-1",children:t.pesoKg})]})]})]}),e.jsxs("div",{className:"relative border border-base-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"absolute -top-3 left-4 bg-base-800 px-2 text-md font-semibold text-brand-primary-light",children:"Filiação"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"maeNome",className:"block text-sm font-medium text-gray-300",children:"Brinco da Mãe"}),e.jsx("input",{type:"text",name:"maeNome",id:"maeNome",value:s.maeNome,onChange:o,className:"mt-1 block w-full bg-base-700 border-base-600 rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary sm:text-sm p-2",placeholder:"Ex: 2024"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"A raça será puxada automaticamente"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"paiNome",className:"block text-sm font-medium text-gray-300",children:"Pai (Brinco ou Nome)"}),e.jsx("input",{type:"text",name:"paiNome",id:"paiNome",value:s.paiNome,onChange:o,className:"mt-1 block w-full bg-base-700 border-base-600 rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary sm:text-sm p-2",placeholder:"Ex: Touro 001"})]})]})]}),e.jsxs("div",{className:"relative border border-base-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"absolute -top-3 left-4 bg-base-800 px-2 text-md font-semibold text-brand-primary-light",children:"Status Inicial"}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-300",children:"Status"}),e.jsx("select",{name:"status",id:"status",value:s.status,onChange:o,className:"mt-1 block w-full bg-base-700 border-base-600 rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary sm:text-sm p-2",children:Object.values(k).map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end mb-24",children:[e.jsx("button",{type:"button",onClick:i,className:"bg-base-700 text-gray-300 hover:bg-base-600 font-bold py-2 px-4 rounded transition-colors mr-2",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:j,className:"bg-brand-primary hover:bg-brand-primary-light text-white font-bold py-2 px-4 rounded transition-colors flex items-center gap-2 disabled:bg-base-700 disabled:cursor-not-allowed",children:[e.jsx(S,{className:"w-5 h-5"}),"Salvar Animal"]})]})]})]})};export{M as default};
