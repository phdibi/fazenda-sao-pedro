import{r as p,j as e,h as y,E as S,T as C,F as M,i as H,H as E,J as k}from"./index-OnCL7RT-.js";import"./vendor-CMJYdXG8.js";const I=({isOpen:r,onClose:i,onSave:u,area:n})=>{const[o,c]=p.useState(""),[x,h]=p.useState("");p.useEffect(()=>{n?(c(n.name),h(String(n.areaHa))):(c(""),h(""))},[n,r]);const j=b=>{b.preventDefault();const g=parseFloat(x);o.trim()&&!isNaN(g)&&g>=0&&(u({id:n==null?void 0:n.id,name:o.trim(),areaHa:g}),i())};return e.jsx(y,{isOpen:r,onClose:i,title:n?"Editar Área de Manejo":"Adicionar Nova Área",children:e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-300",children:"Nome da Área"}),e.jsx("input",{type:"text",id:"name",value:o,onChange:b=>c(b.target.value),className:"mt-1 block w-full bg-base-700 border-base-600 rounded-md shadow-sm p-2",placeholder:"Ex: Pasto A, Invernada B",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"areaHa",className:"block text-sm font-medium text-gray-300",children:"Tamanho (hectares)"}),e.jsx("input",{type:"number",id:"areaHa",value:x,onChange:b=>h(b.target.value),className:"mt-1 block w-full bg-base-700 border-base-600 rounded-md shadow-sm p-2",placeholder:"Ex: 50.5",step:"0.01",min:"0",required:!0})]}),e.jsx("div",{className:"pt-4 flex justify-end items-center",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:i,className:"bg-base-700 text-gray-300 hover:bg-base-600 font-bold py-2 px-4 rounded transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-brand-primary hover:bg-brand-primary-light text-white font-bold py-2 px-4 rounded transition-colors",children:"Salvar"})]})})]})})},w=({animal:r,onToggle:i,isAssigned:u})=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-base-900 rounded-md",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-white",children:["Brinco: ",r.brinco]}),e.jsx("p",{className:"text-xs text-gray-400",children:r.nome||"Sem nome"})]}),e.jsx("button",{onClick:i,className:`p-2 rounded-full transition-colors ${u?"text-red-400 hover:bg-red-900/50":"text-green-400 hover:bg-green-900/50"}`,"aria-label":u?"Remover da área":"Adicionar à área",children:e.jsx(S,{className:`w-4 h-4 ${u?"":"transform rotate-180"}`})})]}),T=({isOpen:r,onClose:i,onSave:u,area:n,allAnimals:o})=>{const[c,x]=p.useState(new Set),[h,j]=p.useState("");p.useEffect(()=>{if(r){const t=new Set(o.filter(m=>m.managementAreaId===n.id).map(m=>m.id));x(t)}},[r,n,o]);const b=t=>{x(m=>{const s=new Set(m);return s.has(t)?s.delete(t):s.add(t),s})},{assignedAnimals:g,availableAnimals:a}=p.useMemo(()=>{var f;const t=h.toLowerCase(),m=[],s=[];for(const l of o)c.has(l.id)?m.push(l):l.status==="Ativo"&&(!l.managementAreaId||l.managementAreaId===n.id)&&(l.brinco.toLowerCase().includes(t)||(f=l.nome)!=null&&f.toLowerCase().includes(t))&&s.push(l);return{assignedAnimals:m.sort((l,N)=>l.brinco.localeCompare(N.brinco)),availableAnimals:s.sort((l,N)=>l.brinco.localeCompare(N.brinco))}},[o,c,h,n.id]),d=()=>{u(n.id,Array.from(c)),i()};return e.jsxs(y,{isOpen:r,onClose:i,title:`Gerenciar Animais em: ${n.name}`,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 min-h-[50vh]",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["Animais na Área (",g.length,")"]}),e.jsx("div",{className:"bg-base-700 p-2 rounded-lg flex-1 overflow-y-auto space-y-2",children:g.length>0?g.map(t=>e.jsx(w,{animal:t,onToggle:()=>b(t.id),isAssigned:!0},t.id)):e.jsx("p",{className:"text-center text-gray-500 pt-8",children:"Nenhum animal nesta área."})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["Animais Disponíveis (",a.length,")"]}),e.jsx("input",{type:"text",value:h,onChange:t=>j(t.target.value),placeholder:"Buscar brinco ou nome...",className:"w-full bg-base-700 border-base-600 rounded-md p-2 mb-2"}),e.jsx("div",{className:"bg-base-700 p-2 rounded-lg flex-1 overflow-y-auto space-y-2",children:a.length>0?a.map(t=>e.jsx(w,{animal:t,onToggle:()=>b(t.id),isAssigned:!1},t.id)):e.jsx("p",{className:"text-center text-gray-500 pt-8",children:"Nenhum animal disponível."})})]})]}),e.jsxs("div",{className:"pt-6 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:i,className:"bg-base-700 text-gray-300 hover:bg-base-600 font-bold py-2 px-4 rounded transition-colors",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:d,className:"bg-brand-primary hover:bg-brand-primary-light text-white font-bold py-2 px-4 rounded transition-colors",children:"Salvar Alterações"})]})]})},L=({isOpen:r,onClose:i,onSave:u,onDelete:n,areas:o})=>{const[c,x]=p.useState([]);p.useEffect(()=>{r&&x(o.map(a=>({...a,areaHa:String(a.areaHa)})))},[r,o]);const h=(a,d,t)=>{x(m=>m.map(s=>s.id===a?{...s,[d]:t}:s))},j=a=>{x(d=>d.filter(t=>t.id!==a))},b=()=>{x(o.map(a=>({...a,areaHa:String(a.areaHa)}))),i()},g=()=>{const a=new Map(o.map(s=>[s.id,s])),d=new Set(c.map(s=>s.id)),t=o.map(s=>s.id).filter(s=>!d.has(s)),m=[];for(const s of c){const f=a.get(s.id);if(!f)continue;const l=parseFloat(s.areaHa),N=f.name!==s.name.trim(),v=f.areaHa!==l;!isNaN(l)&&(N||v)&&m.push({id:s.id,name:s.name.trim(),areaHa:l})}i(),setTimeout(()=>{t.forEach(s=>n(s)),m.forEach(s=>u(s))},0)};return e.jsxs(y,{isOpen:r,onClose:b,title:"Editar Áreas de Manejo",children:[e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:c.length>0?c.sort((a,d)=>a.name.localeCompare(d.name)).map(a=>e.jsxs("div",{className:"grid grid-cols-12 gap-3 items-center p-2 bg-base-700 rounded-md",children:[e.jsxs("div",{className:"col-span-6",children:[e.jsx("label",{htmlFor:`name-${a.id}`,className:"sr-only",children:"Nome da Área"}),e.jsx("input",{type:"text",id:`name-${a.id}`,value:a.name,onChange:d=>h(a.id,"name",d.target.value),className:"w-full bg-base-900 border-base-600 rounded-md shadow-sm p-2 text-sm",placeholder:"Nome da Área",required:!0})]}),e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{htmlFor:`areaHa-${a.id}`,className:"sr-only",children:"Tamanho (ha)"}),e.jsx("input",{type:"number",id:`areaHa-${a.id}`,value:a.areaHa,onChange:d=>h(a.id,"areaHa",d.target.value),className:"w-full bg-base-900 border-base-600 rounded-md shadow-sm p-2 text-sm",placeholder:"Tamanho (ha)",step:"0.01",min:"0",required:!0})]}),e.jsx("div",{className:"col-span-1 flex justify-end",children:e.jsx("button",{onClick:()=>j(a.id),className:"p-2 text-gray-400 hover:text-red-400 hover:bg-red-900/50 rounded-full transition-colors","aria-label":`Marcar ${a.name} para exclusão`,children:e.jsx(C,{className:"w-5 h-5"})})})]},a.id)):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Nenhuma área para editar."})}),e.jsxs("div",{className:"pt-6 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:b,className:"bg-base-700 text-gray-300 hover:bg-base-600 font-bold py-2 px-4 rounded transition-colors",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:g,className:"bg-brand-primary hover:bg-brand-primary-light text-white font-bold py-2 px-4 rounded transition-colors",children:"Salvar Alterações"})]})]})},D=({animals:r,areas:i,onSaveArea:u,onDeleteArea:n,onAssignAnimals:o})=>{const[c,x]=p.useState(!1),[h,j]=p.useState(!1),[b,g]=p.useState(!1),[a,d]=p.useState(null),t=()=>{d(null),x(!0)},m=s=>{d(s),j(!0)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Manejo de Áreas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 bg-base-700 hover:bg-base-600 text-white font-bold py-2 px-4 rounded transition-colors",children:[e.jsx(M,{className:"w-5 h-5"}),"Editar Áreas"]}),e.jsxs("button",{onClick:t,className:"flex items-center gap-2 bg-brand-primary hover:bg-brand-primary-light text-white font-bold py-2 px-4 rounded transition-colors",children:[e.jsx(H,{className:"w-5 h-5"}),"Nova Área"]})]})]}),i.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(s=>{const f=r.filter(v=>v.managementAreaId===s.id),l=f.reduce((v,A)=>v+A.pesoKg,0),N=s.areaHa>0?l/s.areaHa:0;return e.jsxs("div",{className:"bg-base-800 rounded-lg shadow-lg p-5 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-400",children:[s.areaHa.toLocaleString("pt-BR")," ha"]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("span",{className:"text-gray-400",children:"Nº de Animais:"}),e.jsx("span",{className:"font-bold text-white text-lg",children:f.length})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("span",{className:"text-gray-400",children:"Peso Vivo Total:"}),e.jsxs("span",{className:"font-bold text-white text-lg",children:[l.toLocaleString("pt-BR")," kg"]})]}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("span",{className:"text-gray-400",children:"Densidade:"}),e.jsxs("span",{className:`font-bold text-lg ${N>500?"text-yellow-400":"text-white"}`,children:[N.toFixed(2)," kg/ha"]})]})]})]}),e.jsxs("button",{onClick:()=>m(s),className:"mt-6 w-full flex items-center justify-center gap-2 bg-base-700 hover:bg-base-600 text-white font-bold py-2 px-4 rounded transition-colors",children:[e.jsx(E,{className:"w-5 h-5"}),"Gerenciar Animais"]})]},s.id)})}):e.jsxs("div",{className:"text-center py-16 text-gray-500 bg-base-800 rounded-lg",children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Nenhuma área de manejo cadastrada"}),e.jsx("p",{className:"mt-2",children:'Clique em "Nova Área" para começar a organizar seus pastos e invernadas.'})]}),c&&e.jsx(I,{isOpen:c,onClose:()=>x(!1),onSave:u,area:a}),h&&a&&e.jsx(T,{isOpen:h,onClose:()=>j(!1),onSave:o,area:a,allAnimals:r}),e.jsx(L,{isOpen:b,onClose:()=>g(!1),areas:i,onSave:u,onDelete:n})]})};export{D as default};
